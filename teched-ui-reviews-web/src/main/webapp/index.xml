<?xml version="1.0" encoding="UTF-8"?>  
<Module>  
    <ModulePrefs title="ESPM Customer Review Extension" height="250">  
        <Require feature="sap-context" /> 
		<Optional feature="content-rewrite">
	      <Param name="exclude-urls">.*</Param>
	    </Optional>
    </ModulePrefs>  

    <Content type="html">  
    <![CDATA[  
        
        <script id="sap-ui-bootstrap" src="https://sapui5.netweaver.ondemand.com/resources/sap-ui-core.js"
	        data-sap-ui-theme="sap_goldreflection"
	        data-sap-ui-libs="sap.ui.commons, sap.ui.ux3, sap.ui.table">
	    </script>
        
        <script type="text/javascript">
		
			var host = "https://espmp1863875835trial.hanatrial.ondemand.com";
			
			function getUrl(url)
			{
				return gadgets.io.getProxyUrl(host + "/teched-ui-reviews-web/" + url);
			}
			
	        // configure namespaces for UI5
			jQuery.sap.registerModulePath("app", getUrl("portal/js"));
			jQuery.sap.registerModulePath("app.config", getUrl("js/config"));
			jQuery.sap.registerModulePath("app.utility", getUrl("js/utility"));
			jQuery.sap.registerModulePath("app.localstorage", getUrl("js/localstorage"));
			jQuery.sap.registerModulePath("app.viewcache", getUrl("js/viewcache"));
			jQuery.sap.registerModulePath("espm-ui-reviews-web", getUrl("espm-ui-reviews-web"));
			jQuery.sap.registerModulePath("i18n", getUrl("i18n"));
			jQuery.sap.registerModulePath("proxy", getUrl("proxy"));
			
			// initialize view layout as required for embedded usage
			jQuery.sap.require("app.config");
			sap.app.config.displayProductSelectionPanel = false;
			sap.app.config.displayShell= false;
			
			sap.app.config.cloudExtensionOdataServiceUrl = (host + "/teched-ui-reviews-web/" + "espm.svc");
			
		</script>
		
		<script src="portal/js/app.js"></script>
		
		<script language="javascript" type="text/javascript">  
			
			gadgets.util.registerOnLoadHandler(init);

		</script>

		<body class="sapUiBody" role="application" >
		
			<script language="javascript" type="text/javascript">  
		  
			    var subId;  
			    var isSub = false;  
			  
			    function updateReviews(topic, context) 
			    {  
			       if ( context.getPropertyByKey("selectedKey") != null)
			       {
				       	var selectedKey = context.getPropertyByKey("selectedKey")[0];
				       
				       	var oEventBus = sap.ui.getCore().getEventBus();
				       	oEventBus.publish("sap.app", "selectedProductChanged", { selectedProductId : selectedKey });
				       
				       	// make sure to update the productId combo box
					   	sap.ui.getCore().byId("product-selection-dropdown-box-id").setSelectedKey(selectedKey);
			 		}
			    }  
			  
			    /* 
			     * Subscribe to Site Context using sap-context feature. 
			     */  
			    function subscribe() 
			    {  
			        subId = gadgets.sapcontext.subscribe(updateReviews);  
			    }  
			  
			    /* 
			     * Unsubscribe to Site Context using sap-context feature. 
			     */  
			    function unsubscribe() 
			    {  
			        gadgets.sapcontext.unsubscribe(subId);  
			        isSub = false;  
			    }  
			    
			</script>  
				
			<script language="javascript" type="text/javascript">  
		              gadgets.sapcontext.registerOnContextLoad(subscribe);  
		    </script>  

			<div id='content'></div>
		</body>
	]]>  
    </Content>  
</Module>  